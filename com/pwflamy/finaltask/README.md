# Многопоточный обработчик задач

---

## Задача

Разработай консольное Java-приложение, реализующее многопоточную систему обработки задач.

---

## Предварительный этап: Проектирование структуры классов

#### Перед началом реализации кода необходимо:
* Разработать предлагаемую структуру классов вашего приложения.
* Для каждого класса предоставить краткое описание его основной ответственности (что он делает).
* Получить одобрение предложенной структуры и описаний у преподавателя/ментора.

---

## Требования

1.  **Обработка задач в многопоточном режиме:**
    *   Система должна обрабатывать задачи параллельно несколькими потоками.
    *   Количество потоков-обработчиков задается пользователем при запуске программы.
    *   Каждый обработчик должен забирать задачи из общей очереди и выполнять их независимо от других.
    *   **Запрещено использовать** `ExecutorService` или другие высокоуровневые механизмы из пакета `java.util.concurrent` для управления пулом потоков и очередями задач. Требуется реализовать свою версию потоков-воркеров и компонента-оркестратора, управляющего их жизненным циклом и координацией.

2.  **Задачи:**
    *   Каждая задача имеет:
        *   Уникальный непустой идентификатор - инкрементальный счетчик.
        *   Описание (текст).
        *   Текущее состояние.
        *   Длительность выполнения (в миллисекундах).
    *   При обработке задачи поток должен «спать» (`Thread.sleep()`) на время, соответствующее длительности задачи, имитируя выполнение.
    *   Задачи проходят через следующие состояния:
        *   `CREATED`: Задача создана (например, после ввода данных пользователем или чтения из файла).
        *   `QUEUED`: Задача помещена в очередь и ожидает обработки.
        *   `PROCESSING`: Задача взята потоком-обработчиком и выполняется.
        *   `COMPLETED`: Задача успешно выполнена.
        *   `INTERRUPTED`: Выполнение задачи было прервано (например, при остановке системы).
    *   Каждая смена состояния задачи должна логироваться в консоль. В логе также должно присутствовать имя потока, который выполнил смену состояния
        *   Пример лога: `[DATE-TIME] [Worker-1] Task 'task-32' state changed to PROCESSING.`

3.  **Очередь задач:**
    *   Все задачи помещаются в общую очередь, из которой их извлекают потоки-обработчики.
    *   Очередь должна работать по принципу **FIFO** (первым пришёл — первым обслужен).
    *   Новые задачи могут добавляться в очередь во время выполнения программы.
    *   **Реализация очереди должна быть потокобезопасной (thread-safe)**. Для этого потребуется использовать механизмы синхронизации Java.

4.  **Ввод задач:**
    *   Возможность добавлять задачи вручную через консоль, указывая описание и длительность.
    *   Возможность загружать задачи из внешнего файла. Формат файла будет описан ниже **(см. Приложение 1: Формат файла задач)**.
    *   Задачи из файла и консоли поступают в очередь для обработки.

5.  **Управление системой:**
    *   Реализуйте консольное меню для управления приложением (добавление задач, загрузка из файла, просмотр состояния задач, остановка системы). Пример меню будет описан ниже **(см. Приложение 2: Пример консольного меню)**.
    *   Пункт "просмотр состояния задач" должен отображать информацию о всех известных задачах (ID, описание, текущее состояние, имя потока-обработчика, если применимо к текущему состоянию).
    *   Под остановкой системы предполагается **корректное** завершение работы всех текущих потоков-обработчиков. Рекомендуется использовать механизм прерываний (`Thread.interrupt()`) и ожидание их завершения (`Thread.join()`).
    *   При остановке должно выводиться сообщение в консоль, содержащее информацию о том, была ли прервана работа над какой-либо задачей, с указанием данных этой задачи (ID, описание, исходная длительность).
    *   После остановки всех потоков-обработчиков программа должна вывести сообщение, предлагающее пользователю нажать любую клавишу для окончательного закрытия приложения.

6.  **Обработка ошибок и логирование:**
    *   Обрабатывайте возможные ошибки (например, неверный ввод данных, некорректный формат файла, отсутствие файла). Ошибки не должны приводить к аварийному завершению работы программы.
    *   Выводите информативные сообщения о ходе работы, смене состояний задач и возникающих ошибках. Рекомендуется придерживаться формата лога, например: `[DATE-TIME] [THREAD_NAME] Message`.

---

## Приложения

### Приложение 1: Формат файла задач (Пример CSV)

Каждая строка файла представляет одну задачу. Поля разделены точкой с запятой (`;`).
Если обнаружены какие-либо ошибки при обработке файла, то ни одна задача из файла не должна быть поставлена.

**Формат строки:** `описание_задачи;длительность_в_мс`

**Пример (`tasks.csv`):**
```csv
Подготовить отчет;5000
Отправить письма;3000
Провести расчеты;10000
Архивировать данные;2500
```
*Примечание: ID задачи будет генерироваться программой при загрузке.*

### Приложение 2: Примеры консольного меню

#### Основное меню (появляется после запуска и после завершения операции):
```
Многопоточный обработчик задач
--------------------------------
1. Добавить задачу вручную
2. Загрузить задачи из файла
3. Просмотреть состояние задач
4. Остановить систему
0. Выход (после остановки системы)

Выберите опцию:
```

#### 1. Добавить задачу вручную
```
Многопоточный обработчик задач
--------------------------------
1. Добавить задачу вручную
2. Загрузить задачи из файла
3. Просмотреть состояние задач
4. Остановить систему

Выберите опцию: 1
Введите описание задачи: Сделать утренний кофе
Введите длительность задачи (в миллисекундах): 2000
[2025-05-21 01:12:32] [MainThread] Task 'task-1' (Сделать утренний кофе, 2000мс) state changed to CREATED.
[2025-05-21 01:12:32] [MainThread] Task 'task-1' (Сделать утренний кофе, 2000мс) state changed to QUEUED.

Многопоточный обработчик задач
--------------------------------
1. Добавить задачу вручную
... (остальное меню)
Выберите опцию:
```

#### (В фоне, если есть свободный воркер):
```
[2025-05-21 01:12:35] [Worker-1] Task 'task-uuid-generated-1' (Сделать утренний кофе, 2000мс) state changed to PROCESSING.
... (через 2000 мс)
[2025-05-21 01:12:37] [Worker-1] Task 'task-uuid-generated-1' (Сделать утренний кофе, 2000мс) state changed to COMPLETED.
```

#### Обработка ошибки ввода:
```
Многопоточный обработчик задач
--------------------------------
...
Выберите опцию: 1
Введите описание задачи: Помыть посуду
Введите длительность задачи (в миллисекундах): абвгд
[2025-05-21 01:12:35] [MainThread] Ошибка: Введена некорректная длительность. Пожалуйста, введите число.
Задача не добавлена.

Многопоточный обработчик задач
--------------------------------
...
Выберите опцию:
```

#### 2. Загрузить задачи из файла
```
Многопоточный обработчик задач
--------------------------------
...
Выберите опцию: 2
Введите путь к файлу задач (например, tasks.csv): data/tasks.csv
[2025-05-21 01:12:37] [MainThread] Загрузка задач из файла 'data/tasks.csv'...
[2025-05-21 01:12:37] [MainThread] Task 'task-2' (Подготовить отчет, 5000мс) state changed to CREATED.
[2025-05-21 01:12:37] [MainThread] Task 'task-2' (Подготовить отчет, 5000мс) state changed to QUEUED.
[2025-05-21 01:12:37] [MainThread] Task 'task-3' (Отправить письма, 3000мс) state changed to CREATED.
[2025-05-21 01:12:37] [MainThread] Task 'task-3' (Отправить письма, 3000мс) state changed to QUEUED.
Загружено 2 задачи из файла 'data/tasks.csv'.

Многопоточный обработчик задач
--------------------------------
...
Выберите опцию:
```

#### 2. Загрузить задачи из файла
```
Многопоточный обработчик задач
--------------------------------
...
Выберите опцию: 2
Введите путь к файлу задач (например, tasks.csv): data/tasks.csv
[2025-05-21 01:12:37] [MainThread] Загрузка задач из файла 'data/tasks.csv'...
[2025-05-21 01:12:37] [MainThread] Task 'task-2' (Подготовить отчет, 5000мс) state changed to CREATED.
[2025-05-21 01:12:37] [MainThread] Task 'task-2' (Подготовить отчет, 5000мс) state changed to QUEUED.
[2025-05-21 01:12:37] [MainThread] Task 'task-3' (Отправить письма, 3000мс) state changed to CREATED.
[2025-05-21 01:12:37] [MainThread] Task 'task-3' (Отправить письма, 3000мс) state changed to QUEUED.
Загружено 2 задачи из файла 'data/tasks.csv'.

Многопоточный обработчик задач
--------------------------------
...
Выберите опцию:
```

#### 3. Просмотреть состояние задач
```
Многопоточный обработчик задач
--------------------------------
...
Выберите опцию: 3

Состояние задач:
task-1 | Сделать утренний кофе | 2000 | COMPLETED | Worker-1
task-2 | Подготовить отчет | 5000 | PROCESSING | Worker-2
task-3 | Отправить письма | 3000 | QUEUED | -
task-4 | Позвонить клиенту | 10000 | QUEUED | -
(Если список пуст: Список задач пуст.)

Нажмите Enter для возврата в меню... (пользователь нажимает Enter)

Многопоточный обработчик задач
--------------------------------
...
Выберите опцию:
```

#### 4. Остановить систему
```
Многопоточный обработчик задач
--------------------------------
...
Выберите опцию: 4
[2025-05-21 01:12:37] [MainThread] Запрос на остановку системы...
[2025-05-21 01:12:37] [MainThread] Отправка сигнала прерывания потокам-обработчикам...
(В этот момент воркеры начинают завершаться. Если задача выполняется, она прерывается)
[2025-05-21 01:12:37] [Worker-2] Получен сигнал прерывания. Завершаю работу...
[2025-05-21 01:12:37] [Worker-2] Задача 'task-2' (Подготовить отчет, 5000мс) была ПРЕРВАНА. Исходная длительность: 5000мс.
[2025-05-21 01:12:37] [Worker-2] Task 'task-2' (Подготовить отчет, 5000мс) state changed to INTERRUPTED.
[2025-05-21 01:12:37] [Worker-2] Поток Worker-2 завершил работу.
[2025-05-21 01:12:37] [Worker-1] Получен сигнал прерывания. Завершаю работу...
[2025-05-21 01:12:37] [Worker-1] Поток Worker-1 завершил работу.
[2025-05-21 01:12:37] [MainThread] Все потоки-обработчики остановлены.
Система остановлена. Новые задачи не будут обрабатываться.
Оставшиеся в очереди задачи (если есть):
- ID: task-3, Описание: Отправить письма, Длительность: 3000мс, Состояние: QUEUED
- ID: task-4, Описание: Позвонить клиенту, Длительность: 10000мс, Состояние: QUEUED

Нажмите любую клавишу для выхода из программы...
```
---
